@use "../../styles.scss" as styles;
@use "sass:color";

* {
  @include styles.default-styles;
}

@include styles.search-form-styles;

h1, h2, h3, h4, h5, h6 {
  font-family: styles.$font-family;
  color: styles.$primary-text-color;
  margin-bottom: 5px;
}

p {
  font-size: 10px;
  margin: 0px;
  color: styles.$quaternary-text-color;
}

// Overlay styling - makes the component appear as a full-screen overlay
:host {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 1050; // Higher than Bootstrap modals
  display: flex;
  align-items: center;
  justify-content: center;
}

.preview-wrapper {
  width: 95%;
  max-width: 1400px;
  height: 95%;
  max-height: 90vh;
  background-color: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;

  .preview-page {
    height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;

    .preview-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      padding: 20px;
      
      .preview-header {
        button {
          align-self: flex-end;
          font-size: 10px;
        }
      }
      
      // .divider {
      //   margin-bottom: 20px;
      // }
      
      .preview-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;

        .table-section {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          height: 100%;
          
          .header-original, .header-updated {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            
            .table-header-with-filter {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 15px;
              
              h6 {
                margin-bottom: 0px;
                flex: 1;
              }
              
              .filter-toggle-btn {
                margin-left: 15px;
                padding: 4px 8px;
                font-size: 10px;
                border: 1px solid #dee2e6;
                background-color: #f8f9fa;
                color: styles.$primary-text-color;
                border-radius: 4px;
                display: flex;
                align-items: center;
                gap: 4px;
                transition: all 0.2s ease;
                position: relative;
                
                &:hover {
                  border-color: styles.$primary-color;
                  background-color: #e9ecef;
                }
                
                &.active {
                  background-color: styles.$primary-color;
                  border-color: styles.$primary-color;
                  color: white;
                  
                  .tooltip-icon {
                    color: #ffffff !important;
                  }
                }
                
                i.fa-filter {
                  font-size: 9px;
                }
                
                .tooltip-icon {
                  font-size: 8px;
                  color: #999;
                  margin-left: 2px;
                  opacity: 0.7;
                  
                  &:hover {
                    opacity: 1;
                  }
                }
              }
            }
            
            .table-container {
              flex: 1;
              overflow: auto;
              // Allow horizontal scrolling if table becomes too wide
              overflow-x: auto;
              overflow-y: auto;
            }
          }
        }
      }
    }
  }
}

.sticky-top {
  position: sticky;
  top: 42px;
  z-index: 10;
  background-color: styles.$background-color;
  align-content: center;
  justify-content: center;
}

// Filter section
.filter-section {
  .table-header {
    display: flex;
    flex-direction: row;
    justify-content: flex-end;
    align-items: center;
    padding: 8px 0 6px 0;

    button {
      align-self: flex-end;
      font-size: 10px;
    }
  }

  .filter-container {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 10px 15px;
    margin-bottom: 15px;
    
    @media (max-width: 860px) {
      border-radius: 8px;
      padding: 15px;
      background-color: #f8f9fa;
      
      &.mobile-hidden {
        display: none;
      }
      
      // Add smooth transitions for better UX
      transition: opacity 0.3s ease-in-out;
      
      &:not(.mobile-hidden) {
        opacity: 1;
      }
    }
    
    .filter-form {
      margin: 0;
      
      h5 {
        font-size: 16px;
        color: styles.$primary-text-color;
        font-weight: 600;
        
        @media (max-width: 860px) {
          font-size: 14px;
          text-align: center;
        }
        
        .filter-indicator {
          color: styles.$primary-color;
          font-size: 12px;
          font-weight: 500;
          font-style: italic;
        }
      }

      .filter-grid {
        display: grid;
        grid-template-columns: auto 1.5fr 1fr 1fr 1fr auto;
        gap: 12px;
        align-items: center;
        
        @media (max-width: 860px) {
          grid-template-columns: 1fr 1fr 1fr;
          grid-template-rows: auto auto auto auto;
          grid-template-areas:
             "title title title"
             "text-input text-input text-input"
             "condition status processing-status"
             "reset reset reset";
          gap: 8px;

          .filter-title-inline {
            grid-area: title;
          }

          .filter-item:has(#filter-text) {
            grid-area: text-input;
          }

          .filter-item:has(#filter-condition) {
            grid-area: condition;
          }

          .filter-item:has(#filter-status) {
            grid-area: status;
          }

          .filter-item:has(#filter-processing-status) {
            grid-area: processing-status;
          }
          
          .reset-btn {
            grid-area: reset;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0.5rem;
            padding: 6px 10px;
            min-width: 70px;
          }
        }
      }
      
      .filter-title-inline {
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 600;
        color: styles.$primary-text-color;
        font-size: 12px;
        white-space: nowrap;
        
        .filter-icon {
          color: styles.$primary-color;
          font-size: 14px;
        }
        
        @media (max-width: 860px) {
          justify-self: center;
          margin-bottom: 5px;
        }
      }
      
      .filter-item {
        display: flex;
        flex-direction: column;
        
        .filter-label {
          display: none; // Hide labels to save space, rely on placeholders
        }
        
        .filter-input,
        .filter-select {
          font-size: 11px;
          padding: 6px 10px;
          border: 1px solid #ced4da;
          border-radius: 4px;
          background-color: white;
          color: styles.$primary-text-color;
          height: 32px;
          transition: border-color 0.2s ease;
          
          &:focus {
            border-color: styles.$primary-color;
            box-shadow: 0 0 0 0.1rem rgba(0, 123, 255, 0.15);
            outline: 0;
          }
          
          &::placeholder {
            color: #999;
            font-style: italic;
            font-size: 10px;
          }
        }
        
        .filter-select {
          cursor: pointer;
          font-size: 10px;
          
          option {
            padding: 2px;
            font-size: 11px;
          }
        }
      }
      
      .reset-btn {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 10px;
        padding: 6px 10px;
        border-radius: 4px;
        transition: all 0.2s ease;
        height: 32px;
        white-space: nowrap;
        
        @media (max-width: 860px) {
          justify-self: center;
          align-self: center;
        }
        
        &:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }
        
        &:not(:disabled):hover {
          background-color: #6c757d;
          border-color: #6c757d;
          color: white;
        }
        
        i {
          font-size: 9px;
        }
      }
    }
  }
}

/* Assets Table Styles - copied from opname-asset component */
.assets-table {
  width: 100%;
  font-size: 12px;
  background: transparent !important;
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  table-layout: auto; // Allow automatic column sizing
  width: auto;
  white-space: nowrap;
  
  .mat-mdc-table {
    background: transparent !important;
    width: 100%;
    table-layout: auto; // Allow automatic column sizing
  }
  
  // Style the svg arrow sort icon on the table header
  ::ng-deep .mat-sort-header-arrow svg {
    fill: white !important;
    color: white !important;
  }
  
  .mat-mdc-header-row {
    height: 40px;
    background-color: styles.$primary-color !important;
    z-index: 20; // Lower than filter controls
  }
  
  .mat-mdc-row {
    height: 30px;
    cursor: pointer;
    transition: background-color 0.15s ease;
    background-color: white;
    
    &:hover {
      background-color: #f8f9fa !important;
    }
    
    &:active {
      background-color: #e9ecef !important;
    }

    &.pending-row {
      background-color: #fffbe66f !important; // Soft pastel yellow for pending rows

      &:hover {
        background-color: #fcf7c9 !important; // Slightly brighter on hover
      }

      &:active {
        background-color: #fff3b2 !important; // Darker on active
      }

      .mat-mdc-cell:first-child {
        border-left: 4px solid #ffe066; // Soft yellow for pending, good UX contrast
      }
    }
  }
  
  .mat-mdc-header-cell {
    font-size: 11px !important;
    font-weight: 700;
    color: white !important;
    padding: 10px 14px;
    border-bottom: none;
    background-color: styles.$primary-color;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    white-space: nowrap;
    width: auto; // Allow auto-sizing based on content
  }
  
  .mat-mdc-cell {
    font-size: 10px !important;
    padding: 2px 14px;
    color: styles.$primary-text-color;
    border-bottom: 1px solid #b5b5b5b1;
    vertical-align: middle;
  }
  
  // Remove border from last row cells
  .mat-mdc-row:last-child .mat-mdc-cell {
    border-bottom: none;
  }
  
  // Column specific styles
  .asset-tag-cell {
    font-weight: 600;
    color: styles.$primary-color;
  }
  
  .asset-name-cell {
    font-weight: 500;
  }

  // Highlighting for changed cells
  .cell-changed {
    background-color: #fff3cd !important; // Light yellow background
    border-left: 3px solid #ffc107 !important; // Yellow left border
    position: relative;
    color: styles.$primary-text-color;
    
    &::after {
      content: '';
      position: absolute;
      top: 2px;
      right: 2px;
      width: 6px;
      height: 6px;
      background-color: #ffc107;
      border-radius: 50%;
    }
  }
}

// Condition badges
.condition-badge {
  margin-left: 5px;
  font-size: 10px;
  border-radius: 12px;
  text-transform: capitalize;
  
  &.condition-bad {
    padding: 4px 8px;
    font-weight: 600;
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }
}

// Responsive Design
@media (max-width: 980px) {
  .assets-table {
    font-size: 10px;
    
    // .mat-mdc-header-cell,
    // .mat-mdc-cell {
    //   padding: 8px 12px;
    // }
    
    // .mat-mdc-row {
    //   height: 44px;
    // }
    
    // .asset-name-cell {
    //   max-width: 120px;
    // }
    
    // .owner-name-cell {
    //   max-width: 100px;
    // }
  }
}

// Preview-specific responsive design
@media (max-width: 860px) {
  .preview-wrapper {
    width: 98%;
    height: 98%;
    
    .preview-page {
      .preview-content {
        padding: 15px;
        
        // .preview-header {
        //   flex-direction: row;
        //   gap: 15px;
        // }
        
        .preview-body {
          .table-section {
            grid-template-columns: 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 15px;
            
            .header-original, .header-updated {
              .table-header-with-filter {
                flex-direction: row;
                align-items: center;
                
                .filter-toggle-btn {
                  margin-left: 0;
                  align-self: center;
                  font-size: 11px;
                  padding: 6px 12px;
                  
                  .tooltip-icon {
                    display: none; // Hide tooltip icon on mobile to save space
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}