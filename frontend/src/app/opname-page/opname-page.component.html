<main class="opname-wrapper">
    <div class="opname-page">
        <!-- ERROR MESSAGE -->
        <div *ngIf="errorMessage && showToast" class="my-toast align-items-center" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    <p>{{ errorMessage }}</p>
                    <p>Please try again later.</p>
                </div>
                <button type="button" class="btn-close btn-close-black m-auto" (click)="showToast = false" aria-label="Close"></button>
            </div>
        </div>

        <section class="opname-content">
            <div class="opname-header">
                <div class="opname-details">
                    <h5>Opname in progress...</h5>
                    <!-- placeholder -->
                    <p>Site name</p>
                    <p>Started on {{ opnameSession.startDate }}</p>
                </div>
                <div class="buttons">
                    <div class="finish-button">
                        <button class="btn btn-success" (click)="openFinishModal()">
                            Selesai
                        </button>
                    </div>

                    <div class="cancel-button">
                        <button type="button" class="btn btn-danger" (click)="openCancelModal()">
                            Batalkan
                        </button>
                    </div>
                </div>
            </div>

            <div class="opname-body">
                <app-opname-asset [variant]="cardVariant" [showLocation]="showLocation" [sessionID]="sessionID" [siteID]="siteID"></app-opname-asset>
            </div>

            <!-- <div class="error-message">
                <h1 *ngIf="errorMessage">{{ errorMessage }}</h1>
                <p *ngIf="errorMessage">Please try again later.</p>
            </div> -->
        </section>
    </div>
</main>

<div class="modal fade" id="opnameFinished" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fs-5" id="staticBackdropLabel">Apakah Anda yakin ingin menyelesaikan opname?</h5>
            </div>
            <div class="modal-body">
                <p class="confirmation-text">
                    Tindakan ini akan menyelesaikan sesi opname saat ini dan <strong>semua perubahan data akan disimpan</strong>.
                    <br>
                    <br>
                    <strong>Catatan:</strong> Tindakan ini tidak dapat dibatalkan. Setelah selesai, <strong class="text-danger">Anda tidak akan dapat melakukan perubahan lebih lanjut</strong> pada aset dalam sesi ini. Pastikan semua data sudah benar sebelum melanjutkan.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeModal('opnameFinished')">Tutup</button>
                <button class="btn btn-success" (click)="finishOpnameSession()">
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    <span *ngIf="!isLoading">Selesai</span>
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="opnameCanceled" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Apakah Anda yakin ingin membatalkan opname?</h1>
            </div>
            <div class="modal-body">
                <p class="confirmation-text">
                    Tindakan ini akan membatalkan sesi opname saat ini dan <strong class="text-danger">semua perubahan data akan hilang</strong>.
                    <br>
                    <br>
                    <strong>Catatan:</strong> Tindakan ini tidak dapat dibatalkan.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="closeModal('opnameCanceled')">Tutup</button>
                <button class="btn btn-danger" (click)="cancelOpnameSession()">
                    <span *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    <span *ngIf="!isLoading">Batalkan</span>
                </button>
            </div>
        </div>
    </div>
</div>
