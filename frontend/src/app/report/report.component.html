<main class="report-wrapper">
    <div class="report-page">
        <section class="report-content">
            <div class="report-header">
                <div class="report-details">
                    <h5>Opname Report - {{ site.siteName ? site.siteName : dept.deptName + ' Department' }}</h5>
                    <p class="status-opname">Opname Status: {{ opnameSession.status }}</p>
                </div>

                <div class="export-search">
                    <div class="filter-dropdown">
                        <div class="date-dropdown-wrapper">
                            <select id="date" name="date" class="form-control date-dropdown" [(ngModel)]="selectedDate" (change)="onDateChange()">
                                <option value="">Select a date</option>
                                <option *ngFor="let dateOption of dateOptions" [value]="dateOption.value">
                                    {{ dateOption.label }}
                                </option>
                            </select>
                            <i class="calendar-icon fas fa-calendar-alt"></i>
                        </div>
                    </div>
                    
                    <div class="export-buttons">
                        <button type="button"
                                class="export-report-btn export-pdf-btn"
                                (click)="exportToPDF()"
                                [disabled]="!selectedDate || sessionID === -1"
                                [title]="(!selectedDate || sessionID === -1) ? 'Select a date first' : 'Export report as PDF'">
                            <div class="btn-content">
                                <i class="fa-solid fa-file-pdf icon" aria-hidden="true"></i>
                                <span>Export PDF</span>
                            </div>
                        </button>
                        
                        <button type="button"
                                class="export-report-btn export-csv-btn"
                                (click)="exportToCSV()"
                                [disabled]="!selectedDate || sessionID === -1"
                                [title]="(!selectedDate || sessionID === -1) ? 'Select a date first' : 'Export report as CSV'">
                            <div class="btn-content">
                                <i class="fa-solid fa-file-csv icon" aria-hidden="true"></i>
                                <span>Export CSV</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <hr class="divider">

            <div class="opname-body">                
                <div class="report-cards">
                    <!-- Loading skeleton cards -->
                    <ng-container *ngIf="isLoading">
                        <div class="card card-1">
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-number"></div>
                        </div>
                        <div class="card card-2">
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-number"></div>
                        </div>
                        <div class="card card-3">
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-number"></div>
                        </div>
                        <div class="card card-4">
                            <div class="skeleton skeleton-text"></div>
                            <div class="skeleton skeleton-number"></div>
                        </div>
                    </ng-container>

                    <!-- Actual data cards -->
                    <ng-container *ngIf="!isLoading && selectedDate">
                        <div class="card card-1">
                            <p>Sesuai dan Berfungsi</p>
                            <h5>{{ opnameStats.workingAssets }}</h5>
                        </div>
                        <div class="card card-2">
                            <p>Rusak</p>
                            <h5>{{ opnameStats.brokenAssets }}</h5>
                        </div>
                        <div class="card card-3">
                            <p>Selisih Administrasi</p>
                            <h5>{{ opnameStats.misplacedAssets }}</h5>
                        </div>
                        <div class="card card-4">
                            <p>Tidak Ditemukan</p>
                            <h5>{{ opnameStats.missingAssets }}</h5>
                        </div>
                    </ng-container>
                </div>

                <div class="my-container" *ngIf="selectedDate">
                    <app-opname-asset [siteID]="site.siteID" [isInReport]="true" [sessionID]="sessionID"></app-opname-asset>
                </div>

                <div class="no-date-selected" *ngIf="!selectedDate">
                    <p>Please select a date to view the report.</p>
                    <img class="no-date-icon" src="assets/report-second.jpeg" alt="Report Hamster"/>
                </div>
            </div>
        </section>
    </div>

    <!-- Success toast message (at bottom right) -->
    <div *ngIf="successMessage && showSuccessToast" class="my-toast success-toast align-items-center" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
        <div class="toast-body">
            <p>{{ successMessage }}</p>
        </div>
        <button type="button" class="btn-close btn-close-black m-auto" (click)="showSuccessToast = false" aria-label="Close"></button>
    </div>
</div>
</main>

<!-- Loading Overlay -->
<app-loading-overlay 
    [isVisible]="isExporting"
    [title]="getLoadingTitle()"
    [message]="getLoadingMessage()"
    [spinnerColor]="getLoadingColor()">
</app-loading-overlay>